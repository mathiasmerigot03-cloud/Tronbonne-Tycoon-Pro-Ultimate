<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Tronbonne Tycoon Pro Ultimate</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif; background:#f0f4f8; display:flex; flex-direction:column; align-items:center; margin:0; padding:20px;
}
h1 { color:#0077ff; text-shadow:1px 1px 2px #aaa; }
input, button { padding:10px; margin:5px; font-size:16px; border-radius:5px; border:1px solid #ccc; }
button { background:#0077ff; color:white; border:none; cursor:pointer; transition:0.3s; }
button:hover { background:#005bb5; }
#gameDiv { display:none; width:90%; max-width:750px; }
.card { background:white; border-radius:10px; padding:15px; margin:10px 0; box-shadow:0 4px 6px rgba(0,0,0,0.1); text-align:left; }
.bar { width:100%; height:20px; background:#ddd; border-radius:10px; overflow:hidden; margin:5px 0; }
.bar-fill { height:100%; background:#28a745; width:0%; transition:width 0.3s; }
.history, .leaderboard { max-height:150px; overflow-y:auto; padding:10px; background:#fff; border-radius:10px; box-shadow:0 2px 4px rgba(0,0,0,0.1); margin-top:10px; font-size:14px; }
.notification { color:white; padding:5px 10px; border-radius:5px; margin:10px auto; display:inline-block; opacity:0; transition:opacity 0.5s; font-weight:bold; }
.success { background:#28a745; }
.error { background:#dc3545; }
#chart { width:100%; height:150px; background:#fff; border-radius:10px; margin-top:10px; position:relative; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
.bar-chart { position:absolute; bottom:0; width:20px; background:#0077ff; border-radius:3px 3px 0 0; }
</style>
</head>
<body>

<h1>ğŸ¢ Tronbonne Tycoon Pro Ultimate</h1>

<div id="loginDiv">
  <h2>Connexion</h2>
  <input id="username" placeholder="Pseudo">
  <button onclick="login()">Se connecter</button>
</div>

<div id="gameDiv">

  <div class="card">
    <h3>ğŸ“Š Tableau de bord</h3>
    ğŸ’° Argent : <span id="argent">0</span> â‚¬<br>
    ğŸ“¦ Trombonnes : <span id="trombonnes">0</span> / <span id="stockMax">10</span><br>
    ğŸ‘· EmployÃ©s : <span id="employees">0</span><br>
    ğŸ“ˆ Revenus cumulÃ©s : <span id="revenuTotal">0</span> â‚¬<br>
    ğŸ’² Prix trombonne actuel : <span id="pricePerItem">10</span> â‚¬
    <div class="bar"><div id="stockBar" class="bar-fill"></div></div>
  </div>

  <div class="card">
    <button onclick="collect()">ğŸ“ Collecter une trombonne</button>
    <button onclick="sell()">ğŸ’° Vendre toutes les trombonnes</button>
    <button onclick="upgrade()">ğŸ—ï¸ Augmenter capacitÃ© (+5) â€“ 50â‚¬</button>
    <button onclick="hire()">ğŸ‘· Embaucher un employÃ© â€“ 200â‚¬</button>
    <button onclick="invest()">ğŸ“ˆ Investissement alÃ©atoire â€“ 100â‚¬</button>
    <button onclick="logout()">ğŸšª DÃ©connexion</button>
  </div>

  <div id="notif" class="notification"></div>

  <div class="card">
    <h3>ğŸ“œ Historique des actions</h3>
    <div class="history" id="history"></div>
  </div>

  <div class="card">
    <h3>ğŸ“ˆ Graphique des revenus</h3>
    <div id="chart"></div>
  </div>

  <div class="card">
    <h3>ğŸ† Leaderboard local</h3>
    <div class="leaderboard" id="leaderboard"></div>
  </div>

</div>

<audio id="soundClick" src="https://freesound.org/data/previews/256/256113_3263906-lq.mp3"></audio>
<audio id="soundCash" src="https://freesound.org/data/previews/341/341695_5121236-lq.mp3"></audio>
<audio id="soundAlert" src="https://freesound.org/data/previews/170/170415_2394245-lq.mp3"></audio>

<script>
let user=null;
let autoInterval=null;

// Sons
const soundClick=document.getElementById('soundClick');
const soundCash=document.getElementById('soundCash');
const soundAlert=document.getElementById('soundAlert');

// Load user
function load(){
  const name=localStorage.getItem('lastUser');
  if(name){
    const saved=localStorage.getItem('tronbonneUser_'+name);
    if(saved) user=JSON.parse(saved);
  }
}

// Save user
function saveUser(){
  if(user){
    localStorage.setItem('tronbonneUser_'+user.pseudo,JSON.stringify(user));
    localStorage.setItem('lastUser',user.pseudo);
    updateLeaderboard();
  }
}

// Notify
function notify(msg,type="success"){
  const n=document.getElementById('notif');
  n.innerText=msg; n.className='notification '+type; n.style.opacity=1;
  if(type==="success") soundCash.play(); else if(type==="error") soundAlert.play();
  setTimeout(()=>{n.style.opacity=0;},2000);
}

// History
function addHistory(msg){
  const h=document.getElementById('history');
  const entry=document.createElement('div');
  entry.innerText=`[${new Date().toLocaleTimeString()}] ${msg}`;
  h.prepend(entry);
  if(h.children.length>50) h.removeChild(h.lastChild);
}

// Leaderboard
function updateLeaderboard(){
  const lb=document.getElementById('leaderboard');
  lb.innerHTML='';
  const users=[];
  for(let i=0;i<localStorage.length;i++){
    const key=localStorage.key(i);
    if(key.startsWith('tronbonneUser_')){
      const u=JSON.parse(localStorage.getItem(key));
      users.push({pseudo:u.pseudo, revenu:u.revenuTotal});
    }
  }
  users.sort((a,b)=>b.revenu-a.revenu);
  users.slice(0,5).forEach(u=>{
    const div=document.createElement('div');
    div.innerHTML=`${u.pseudo}: ${u.revenu}â‚¬`;
    if(user && u.pseudo===user.pseudo) div.style.fontWeight='bold';
    lb.appendChild(div);
  });
}

// Login
function login(){
  const name=document.getElementById('username').value.trim();
  if(!name) return notify("Met un pseudo !","error");
  user=JSON.parse(localStorage.getItem('tronbonneUser_'+name))||{
    pseudo:name, argent:500, trombonnes:0, stockMax:10, revenuTotal:0, employees:0, revenusHistory:[], pricePerItem:10
  };
  document.getElementById('loginDiv').style.display='none';
  document.getElementById('gameDiv').style.display='block';
  updateUI(); startAutoProduction(); notify("ConnectÃ© !","success"); addHistory("Connexion rÃ©ussie"); saveUser();
}

// Actions
function collect(){
  if(user.trombonnes>=user.stockMax) return notify("Stock plein !","error");
  user.trombonnes++; updateUI(); saveUser(); addHistory("Collecte manuelle"); animateCollect(); soundClick.play();
}

function sell(){
  if(user.trombonnes===0) return notify("Rien Ã  vendre !","error");
  const revenue=Math.floor(user.trombonnes*user.pricePerItem);
  user.argent+=revenue; user.revenuTotal+=revenue; user.revenusHistory.push(revenue);
  addHistory(`Vente: ${user.trombonnes} trombonnes â†’ +${revenue}â‚¬`);
  user.trombonnes=0; fluctuatePrice(); updateUI(); saveUser(); notify(`Vendu ! +${revenue}â‚¬`,"success"); updateChart();
}

function upgrade(){
  if(user.argent<50) return notify("Pas assez d'argent !","error");
  user.argent-=50; user.stockMax+=5; addHistory("CapacitÃ© augmentÃ©e de 5"); updateUI(); saveUser(); notify("CapacitÃ© augmentÃ©e","success");
}

function hire(){
  if(user.argent<200) return notify("Pas assez d'argent !","error");
  user.argent-=200; user.employees++; addHistory("Nouvel employÃ© embauchÃ©"); updateUI(); saveUser(); notify("EmployÃ© embauchÃ©","success");
}

function invest(){
  if(user.argent<100) return notify("Pas assez d'argent !","error");
  user.argent-=100;
  const chance=Math.random();
  if(chance<0.2){ notify("Ã‰chec de l'investissement !","error"); addHistory("Investissement ratÃ©"); return;}
  const gain=Math.floor(Math.random()*300); user.argent+=gain; user.revenuTotal+=gain; user.revenusHistory.push(gain);
  addHistory(`Investissement rÃ©ussi +${gain}â‚¬`); updateUI(); saveUser(); notify(`Investissement rÃ©ussi +${gain}â‚¬`,"success"); updateChart();
}

// Auto production
function startAutoProduction(){
  if(autoInterval) clearInterval(autoInterval);
  autoInterval=setInterval(()=>{
    if(user.employees>0){
      const prod=user.employees;
      const available=user.stockMax-user.trombonnes;
      const toAdd=Math.min(prod,available);
      if(toAdd>0){ user.trombonnes+=toAdd; updateUI(); saveUser(); animateCollect(); addHistory(`${toAdd} trombonnes produites par employÃ©s`);}
    }
    randomEvents();
  },3000);
}

// Random events
function randomEvents(){
  const chance=Math.random();
  if(chance<0.05 && user.trombonnes>0){ // panne
    const lost=Math.floor(Math.random()*user.trombonnes)+1;
    user.trombonnes-=lost; updateUI(); saveUser(); notify(`Panne ! Perte de ${lost} trombonnes`,"error"); addHistory(`Panne: -${lost} trombonnes`);}
  else if(chance<0.1){ // commande spÃ©ciale
    const bonus=Math.floor(Math.random()*50+20);
    user.argent+=bonus; user.revenuTotal+=bonus; updateUI(); saveUser(); notify(`Commande spÃ©ciale ! +${bonus}â‚¬`,"success"); addHistory(`Commande spÃ©ciale: +${bonus}â‚¬`);}
}

// Price fluctuation
function fluctuatePrice(){
  const change=(Math.random()*4-2); user.pricePerItem=Math.max(5,Math.min(20,user.pricePerItem+change));
  document.getElementById('pricePerItem').innerText=user.pricePerItem;
}

// Logout
function logout(){
  saveUser(); user=null; document.getElementById('loginDiv').style.display='block'; document.getElementById('gameDiv').style.display='none'; notify("DÃ©connectÃ©","success"); clearInterval(autoInterval);
}

// Update UI
function updateUI(){
  document.getElementById('argent').innerText=user.argent;
  document.getElementById('trombonnes').innerText=user.trombonnes;
  document.getElementById('stockMax').innerText=user.stockMax;
  document.getElementById('employees').innerText=user.employees;
  document.getElementById('revenuTotal').innerText=user.revenuTotal;
  document.getElementById('pricePerItem').innerText=user.pricePerItem;
  const percent=(user.trombonnes/user.stockMax)*100;
  document.getElementById('stockBar').style.width=percent+'%';
}

// Chart
function updateChart(){
  const chart=document.getElementById('chart'); chart.innerHTML='';
  const max=Math.max(...user.revenusHistory,10);
  user.revenusHistory.slice(-10).forEach((v,i)=>{
    const b=document.createElement('div'); b.className='bar-chart'; b.style.height=(v/max*100)+'%'; b.style.left=(i*22)+'px'; chart.appendChild(b);
  });
}

// Animation trombonne
function animateCollect(){
  const el=document.createElement('span'); el.innerText='ğŸ“'; el.style.position='absolute';
  el.style.left=(Math.random()*window.innerWidth*0.8+50)+'px'; el.style.top='50px'; el.style.fontSize='24px';
  document.body.appendChild(el); let top=50;
  const id=setInterval(()=>{ top+=2; el.style.top=top+'px'; if(top>200){ clearInterval(id); el.remove(); } },10);
}

load();
</script>

</body>
</html>
